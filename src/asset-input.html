<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Asset Value Input</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background-color: #f5f5f5;
        padding: 20px;
        line-height: 1.6;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
        font-weight: 300;
      }

      .header p {
        opacity: 0.9;
        font-size: 1.1em;
      }

      .assets-container {
        padding: 30px;
      }

      .asset-group {
        margin-bottom: 20px;
        border: 1px solid #e1e5e9;
        border-radius: 8px;
        overflow: hidden;
        transition: box-shadow 0.3s ease;
      }

      .asset-group:hover {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .asset-header {
        background: #f8f9fa;
        padding: 20px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: background-color 0.3s ease;
      }

      .asset-header:hover {
        background: #e9ecef;
      }

      .asset-header.active {
        background: #e3f2fd;
      }

      .asset-info {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .asset-type-badge {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.8em;
        font-weight: 600;
        text-transform: uppercase;
      }

      .type-simple {
        background: #e8f5e8;
        color: #2e7d32;
      }

      .type-investment {
        background: #fff3e0;
        color: #f57c00;
      }

      .type-composite {
        background: #f3e5f5;
        color: #7b1fa2;
      }

      .type-stock {
        background: #e3f2fd;
        color: #1976d2;
      }

      .asset-name {
        font-size: 1.2em;
        font-weight: 600;
        color: #333;
      }

      .currency-label {
        background: #212529;
        color: white;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.8em;
        margin-left: 10px;
      }

      .collapse-icon {
        font-size: 1.5em;
        transition: transform 0.3s ease;
        color: #666;
      }

      .collapse-icon.rotated {
        transform: rotate(180deg);
      }

      .asset-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease, padding 0.3s ease;
        background: white;
      }

      .asset-content.expanded {
        max-height: 300px;
        padding: 25px;
      }

      .input-group {
        margin-bottom: 20px;
      }

      .input-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #333;
      }

      .input-field {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e1e5e9;
        border-radius: 6px;
        font-size: 1em;
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
      }

      .input-field:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .value-summary {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 6px;
        margin-top: 15px;
        display: none;
      }

      .value-summary.has-value {
        display: block;
      }

      .summary-text {
        color: #666;
        font-size: 0.9em;
      }

      .summary-value {
        font-size: 1.3em;
        font-weight: 600;
        color: #333;
        margin-top: 5px;
      }

      .actions {
        padding: 30px;
        background: #f8f9fa;
        text-align: center;
        border-top: 1px solid #e1e5e9;
      }

      .btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 8px;
        font-size: 1.1em;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        margin: 0 10px;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
      }

      .btn-secondary {
        background: #6c757d;
      }

      .btn-secondary:hover {
        box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
      }

      @media (max-width: 768px) {
        .container {
          margin: 0;
          border-radius: 0;
        }

        .header {
          padding: 20px;
        }

        .header h1 {
          font-size: 2em;
        }

        .assets-container {
          padding: 20px;
        }

        .asset-header {
          padding: 15px;
        }

        .asset-content.expanded {
          padding: 20px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>Asset Portfolio</h1>
        <p>Update current values for your assets</p>
      </div>
      <div class="assets-container" id="assetsContainer">
        <!-- Assets will be generated dynamically -->
      </div>

      <div class="actions">
        <button class="btn" onclick="saveAllValues()">Save All Values</button>
        <button class="btn btn-secondary" onclick="resetAllValues()">
          Reset All
        </button>
      </div>
    </div>
    <script>
      // Assets data from assets.ndjson
      const assets = [
        { name: "招行.活期", type: "simple" },
        { name: "招行.沪深300ETF", type: "investment" },
        { name: "国金", type: "composite" },
        { name: "StockAward", type: "stock", currency: "USD" },
      ];

      function generateAssetGroup(asset) {
        const currency = asset.currency || "CNY";
        const currencySymbol = currency === "USD" ? "$" : "¥";
        const currencyLabel =
          currency === "USD"
            ? `<span class="currency-label">${currency}</span>`
            : "";

        let inputFields = "";
        let summaryText = "";
        let summaryValue = "";

        // Generate input fields based on asset type
        switch (asset.type) {
          case "simple":
            inputFields = `
                        <div class="input-group">
                            <label class="input-label">Current Value</label>
                            <input type="number" class="input-field" placeholder="Enter current value" 
                                   oninput="updateSummary(this)" step="0.01" min="0">
                        </div>`;
            summaryText = "Current Value";
            summaryValue = `${currencySymbol}0.00`;
            break;

          case "investment":
            inputFields = `
                        <div class="input-group">
                            <label class="input-label">Current Value</label>
                            <input type="number" class="input-field" placeholder="Enter current value" 
                                   oninput="updateSummary(this)" step="0.01" min="0">
                        </div>`;
            summaryText = "Current Value";
            summaryValue = `${currencySymbol}0.00`;
            break;

          case "composite":
            inputFields = `
                        <div class="input-group">
                            <label class="input-label">Current Value</label>
                            <input type="number" class="input-field" placeholder="Enter current value" 
                                   oninput="updateSummary(this)" step="0.01" min="0">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Current Market Value</label>
                            <input type="number" class="input-field" placeholder="Enter current market value" 
                                   step="0.01" min="0">
                        </div>`;
            summaryText = "Current Value";
            summaryValue = `${currencySymbol}0.00`;
            break;

          case "stock":
            inputFields = `
                        <div class="input-group">
                            <label class="input-label">Units/Shares</label>
                            <input type="number" class="input-field" placeholder="Number of shares" 
                                   oninput="updateSharesSummary(this)" step="1" min="0">
                        </div>`;
            summaryText = "Number of Shares";
            summaryValue = "0";
            break;
        }

        return `
                <div class="asset-group">
                    <div class="asset-header" onclick="toggleAsset(this)">
                        <div class="asset-info">
                            <span class="asset-type-badge type-${asset.type}">${
          asset.type.charAt(0).toUpperCase() + asset.type.slice(1)
        }</span>
                            <span class="asset-name">${asset.name}</span>
                            ${currencyLabel}
                        </div>
                        <span class="collapse-icon">▼</span>
                    </div>
                    <div class="asset-content">
                        ${inputFields}
                        <div class="value-summary">
                            <div class="summary-text">${summaryText}</div>
                            <div class="summary-value">${summaryValue}</div>
                        </div>
                    </div>
                </div>
            `;
      }

      function generateAllAssets() {
        const container = document.getElementById("assetsContainer");
        container.innerHTML = assets
          .map((asset) => generateAssetGroup(asset))
          .join("");
      }

      function toggleAsset(header) {
        const content = header.nextElementSibling;
        const icon = header.querySelector(".collapse-icon");

        // Toggle active state
        header.classList.toggle("active");

        // Toggle content visibility
        if (content.classList.contains("expanded")) {
          content.classList.remove("expanded");
          icon.classList.remove("rotated");
        } else {
          content.classList.add("expanded");
          icon.classList.add("rotated");
        }
      }

      function updateSummary(input) {
        const assetGroup = input.closest(".asset-group");
        const summary = assetGroup.querySelector(".value-summary");
        const summaryValue = assetGroup.querySelector(".summary-value");
        const assetName = assetGroup.querySelector(".asset-name").textContent;

        const value = parseFloat(input.value) || 0;

        if (value > 0) {
          summary.classList.add("has-value");

          // Determine currency based on asset
          let currency = "¥";
          if (assetName === "StockAward") {
            currency = "$";
          }

          summaryValue.textContent = `${currency}${value.toLocaleString(
            "en-US",
            {
              minimumFractionDigits: 2,
              maximumFractionDigits: 2,
            }
          )}`;
        } else {
          summary.classList.remove("has-value");
        }
      }

      function updateSharesSummary(input) {
        const assetGroup = input.closest(".asset-group");
        const summary = assetGroup.querySelector(".value-summary");
        const summaryValue = assetGroup.querySelector(".summary-value");

        const shares = parseInt(input.value) || 0;

        if (shares > 0) {
          summary.classList.add("has-value");
          summaryValue.textContent = shares.toLocaleString("en-US");
        } else {
          summary.classList.remove("has-value");
          summaryValue.textContent = "0";
        }
      }

      function saveAllValues() {
        const assets = [];
        const assetGroups = document.querySelectorAll(".asset-group");

        assetGroups.forEach((group) => {
          const name = group.querySelector(".asset-name").textContent;
          const type = group
            .querySelector(".asset-type-badge")
            .textContent.toLowerCase();
          const currency =
            group.querySelector(".currency-label")?.textContent || "CNY";
          const inputs = group.querySelectorAll('input[type="number"]');

          const asset = {
            name: name,
            type: type,
            currency: currency,
            lastUpdated: new Date().toISOString(),
          };

          // Add fields based on asset type
          if (type === "simple") {
            asset.currentValue = parseFloat(inputs[0].value) || 0;
          } else if (type === "investment") {
            asset.currentValue = parseFloat(inputs[0].value) || 0;
          } else if (type === "composite") {
            asset.currentValue = parseFloat(inputs[0].value) || 0;
            asset.currentMarketValue = parseFloat(inputs[1].value) || 0;
          } else if (type === "stock") {
            asset.shares = parseInt(inputs[0].value) || 0;
          }

          assets.push(asset);
        });

        // In a real implementation, this would send data to the backend
        console.log("Saving asset values:", assets);
        alert("Asset values saved successfully!");

        // You can also trigger VS Code extension functionality here
        if (window.acquireVsCodeApi) {
          const vscode = window.acquireVsCodeApi();
          vscode.postMessage({
            command: "saveAssetValues",
            data: assets,
          });
        }
      }

      function resetAllValues() {
        if (
          confirm(
            "Are you sure you want to reset all values? This action cannot be undone."
          )
        ) {
          const inputs = document.querySelectorAll("input");
          inputs.forEach((input) => {
            input.value = "";
          });

          const summaries = document.querySelectorAll(".value-summary");
          summaries.forEach((summary) => {
            summary.classList.remove("has-value");
          });

          alert("All values have been reset.");
        }
      } // Auto-expand first asset on load
      
      document.addEventListener("DOMContentLoaded", function () {
        // Generate all assets first
        generateAllAssets();

        // Then expand the first asset
        const firstAssetHeader = document.querySelector(".asset-header");
        if (firstAssetHeader) {
          toggleAsset(firstAssetHeader);
        }
      });
    </script>
  </body>
</html>
